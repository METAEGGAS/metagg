<!doctype html><html lang="ar" dir="rtl"><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no"><title>منصة التداول</title><style>*{margin:0;padding:0;box-sizing:border-box}html,body{font-family:system-ui,-apple-system,"Segoe UI",Tahoma,Arial,sans-serif;background:#000;color:#fff;direction:rtl;overflow:hidden;height:100vh;width:100vw;position:fixed;inset:0}button,input{font:inherit;border:0;outline:0}button{cursor:pointer}:root{--psw:44px;--psbg:rgba(0,0,0,0);--psshadow:none;--plshadow:none;--bb1:#2a3442;--bb2:#222b36}:root[data-psmode="0"]{--psbg:rgba(0,0,0,.35);--psshadow:inset 1px 0 0 rgba(255,255,255,.10),0 0 18px rgba(0,0,0,.35);--plshadow:0 1px 3px rgba(0,0,0,.6)}.top-bar{display:flex;justify-content:space-between;align-items:center;padding:6px 10px;background:#000;height:50px}.balance{display:flex;align-items:center;gap:5px;background:#0d1117;border:1px solid #1f2937;border-radius:8px;padding:6px 10px}.flag-icon{width:18px;height:12px;border-radius:2px}.balance-amount{font-size:14px;font-weight:800}.arrow-down{width:12px;height:12px;margin-right:3px}.top-icons{display:flex;gap:6px}.icon-box{width:35px;height:35px;display:flex;align-items:center;justify-content:center;cursor:pointer;border-radius:8px;overflow:hidden}.icon-box.bright-green{background:#00ff41;border:1px solid #00cc33}.icon-box.dark{background:#0d1117;border:1px solid #1f2937}.icon-box img{width:100%;height:100%;object-fit:cover}.datetime{font-size:11px;color:#00ff88;position:absolute;top:55px;right:10px;z-index:10;background:rgba(0,0,0,.7);padding:4px 8px;border-radius:6px}.chart-container{position:relative;height:calc(100vh - 300px);background:#000;min-height:220px;transition:height .22s}.chart-frame{position:absolute;inset:0}.tc{position:absolute;inset:0;overflow:hidden;background:transparent}#c{position:absolute;inset:0;width:100%;height:100%;padding:8px;touch-action:pan-x;cursor:grab}#c:active{cursor:grabbing}.ps{position:absolute;right:0;top:0;bottom:0;width:var(--psw);pointer-events:none;background:var(--psbg)!important;box-shadow:var(--psshadow)!important;z-index:10}.pl{position:absolute;right:2px;transform:translateY(-50%);font-size:9px;font-weight:900;color:rgba(240,230,210,.92);text-align:right;padding:0 3px;text-shadow:var(--plshadow)!important}.cpl{position:absolute;right:0;height:1px;width:100%;background:rgba(255,255,255,.85);opacity:.85;z-index:15}.cpt{position:absolute;right:2px;transform:translateY(-50%);background:#fff;color:#000;padding:2px 6px;border-radius:3px;font-size:9px;font-weight:900;z-index:16}.pair-box{position:absolute;left:12px;bottom:12px;z-index:20;display:inline-flex;align-items:center;gap:6px;background:#0d1117;border:1px solid #1f2937;border-radius:10px;padding:6px 10px}.flag-icon-small{width:18px;height:12px;border-radius:2px}.pair-text{font-size:14px;font-weight:900}.pair-arrow{width:14px;height:14px}.settings-icon{position:absolute;right:12px;bottom:10px;width:28px;height:28px;display:flex;align-items:center;justify-content:center;background:#0d1117;border:1px solid #1f2937;border-radius:50%;cursor:pointer;z-index:20}.settings-icon svg{width:16px;height:16px;stroke:#fff;stroke-width:2}.toggle-ctrl{position:absolute;left:50%;transform:translateX(-50%);bottom:10px;background:#3b82f6;border:none;color:#fff;padding:6px 12px;border-radius:10px;font-size:10px;cursor:pointer;z-index:25;font-weight:900}.toggle-ctrl:active{background:#2563eb}.ctrlPanel{position:fixed;right:10px;top:70px;z-index:1800;width:min(360px,calc(100vw - 20px));background:rgba(10,22,40,.72);backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,.10);border-radius:14px;padding:10px;pointer-events:auto;box-shadow:0 12px 30px rgba(0,0,0,.35)}.ctrlTitle{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:8px}.ctrlTitle b{font-size:12px;font-weight:1000;opacity:.95}.pills{display:flex;gap:6px;flex-wrap:wrap}.pill{padding:7px 10px;border-radius:999px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.10);color:#d9e6ff;font-weight:1000;font-size:11px}.pill.primary{background:rgba(24,209,123,.14);border-color:rgba(24,209,123,.55);color:#00e676}.gridBtns{display:grid;grid-template-columns:1fr 1fr;gap:6px}.gbtn{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:9px 10px;border-radius:12px;background:rgba(255,255,255,.035);border:1px solid rgba(255,255,255,.09);color:#d9e6ff;font-weight:1000;font-size:11px}.gbtn small{opacity:.7;font-weight:900}.card{background:rgba(8,14,26,.92);border:1px solid rgba(255,255,255,.10);border-radius:12px;padding:8px;backdrop-filter:blur(6px);margin-bottom:6px}.row{display:flex;align-items:center;justify-content:space-between;gap:8px}.lbl{color:rgba(255,255,255,.6);font-size:10.5px}.val{color:#d9e6ff;font-weight:1000;font-size:12px}.ctrl{display:flex;align-items:center;gap:6px;background:rgba(0,0,0,.35);border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:7px}.ctrl button{width:28px;height:28px;border-radius:999px;background:rgba(255,255,255,.10);border:1px solid rgba(255,255,255,.14);color:#fff;font-size:18px;display:grid;place-items:center}.ctrl input{width:100%;background:rgba(10,22,40,.95);border:1px solid rgba(255,255,255,.12);border-radius:10px;color:#d9e6ff;font-weight:1000;text-align:center;font-size:12px;padding:6px 8px;min-width:0}.time-bar{display:flex;justify-content:space-between;align-items:center;padding:6px 10px;background:#000;border-top:1px solid #111;border-bottom:1px solid #111;margin-bottom:8px}.time-item{font-size:10px;color:#888;font-weight:700}.trading-controls{padding:10px;background:#000}.control-row{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:10px}.input-group{display:flex;flex-direction:column;gap:4px}.input-label{font-size:10px;color:#888;text-align:right}.input-wrapper{display:flex;align-items:center;gap:4px;background:#0d1117;border:1px solid #1f2937;border-radius:8px;padding:4px 6px;height:36px}.input-field{background:0 0;border:none;color:#fff;font-size:13px;font-weight:900;text-align:center;outline:0;flex:1;min-width:0}.ctrl-btn{background:0 0;border:none;color:#60a5fa;font-size:16px;cursor:pointer;padding:2px 5px;font-weight:1000;flex-shrink:0}.ctrl-btn:active{opacity:.6}.time-icon{width:14px;height:14px;fill:#888;flex-shrink:0}.trading-buttons{display:flex;gap:8px;margin-bottom:8px}.trade-btn{flex:1;display:flex;align-items:center;justify-content:center;gap:6px;padding:12px 8px;border:none;border-radius:10px;font-size:15px;font-weight:1000;cursor:pointer;transition:transform .15s;height:46px}.trade-higher{background:linear-gradient(135deg,#00ff41 0%,#00cc33 100%);color:#000}.trade-lower{background:linear-gradient(135deg,#ff0000 0%,#cc0000 100%);color:#fff}.trade-higher:active,.trade-lower:active{transform:scale(.95)}.btn-icon{width:16px;height:16px;flex-shrink:0}.btn-text{white-space:nowrap}.bottom-nav{position:fixed;bottom:0;left:0;width:100%;display:flex;justify-content:space-around;background:linear-gradient(180deg,var(--bb1),var(--bb2));border-top:1px solid rgba(96,165,250,.25);padding:6px 0 8px;z-index:2000}.nav-item{display:flex;flex-direction:column;align-items:center;gap:3px;cursor:pointer;padding:4px 10px;flex:1}.nav-icon{width:24px;height:24px;object-fit:contain;filter:contrast(1.25) brightness(1.2) drop-shadow(0 6px 12px rgba(0,0,0,.35))}.nav-label{font-size:10px;color:#aab4c0;font-weight:900}.nav-item.active .nav-label{color:#60a5fa}.nav-item.active .nav-icon{filter:contrast(1.35) brightness(1.28) drop-shadow(0 0 7px rgba(96,165,250,.45))}@media(max-width:920px){.ctrlPanel{top:auto;bottom:140px}}</style><body><div class="top-bar"><div class="balance"><img src="https://flagcdn.com/w40/us.png" class="flag-icon"><span class="balance-amount">0.00$</span><svg class="arrow-down" viewBox="0 0 24 24" fill="#888"><path d="M7 10l5 5 5-5z"></path></svg></div><div class="top-icons"><div class="icon-box bright-green"><img src="https://cdn-icons-png.flaticon.com/128/11937/11937688.png"></div><div class="icon-box dark"><img src="https://cdn-icons-png.flaticon.com/128/149/149071.png"></div></div></div><div class="datetime" id="datetime"></div><div class="chart-container" id="chartContainer"><div class="chart-frame"><div class="tc"></div></div><canvas id="c"></canvas><div class="ps" id="ps"></div><div class="cpl" id="cpl"></div><div class="cpt" id="cpt"></div><div class="pair-box"><span class="pair-text">EUR/USD</span><img src="https://flagcdn.com/w40/us.png" class="flag-icon-small"><svg class="pair-arrow" viewBox="0 0 24 24" fill="#0f0"><path d="M7 14l5-5 5 5z"></path></svg></div><div class="settings-icon" id="dots" title="إعدادات"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="4" cy="12" r="1"></circle><circle cx="12" cy="12" r="1"></circle><circle cx="20" cy="12" r="1"></circle></svg></div><button class="toggle-ctrl" id="toggleCtrlMini">عرض التحكم</button></div><div class="ctrlPanel" id="ctrlPanel"><div class="ctrlTitle"><b>مقاسات الشارت</b><div class="pills"><button class="pill" id="toggleCtrl">إخفاء</button><button class="pill primary" id="saveLocal">حفظ عام</button></div></div><div class="card"><div class="row"><div class="lbl">شريط الأسعار</div><div class="val"><span id="pswVal">44</span>px</div></div><div class="ctrl"><button id="pswMinus">-</button><input id="pswInp" inputmode="numeric" value="44"><button id="pswPlus">+</button></div><div class="row" style="margin-top:6px"><div class="lbl">وضع الشفافية</div><div class="val"><button class="pill" id="psToggle" style="padding:6px 10px">Overlay</button></div></div></div><div class="card"><div class="row"><div class="lbl">تثبيت أول شمعة</div><div class="val" id="pinState">OFF</div></div><div class="gridBtns" style="grid-template-columns:1fr 1fr"><button class="gbtn" id="pinFirst">تثبيت</button><button class="gbtn" id="unpinFirst">فصل</button></div></div><div class="card"><div class="row"><div class="lbl">Zoom (Grid/Screen)</div><div class="val" id="maxZoomTxt">1.00x</div></div><div class="gridBtns" style="grid-template-columns:1fr"><button class="gbtn" id="resetAll">Reset</button></div></div><div class="gridBtns"><button class="gbtn" id="panL">تحريك <small>◀</small></button><button class="gbtn" id="panR">تحريك <small>▶</small></button><button class="gbtn" id="viewOut">بيانات أكتر <small>−</small></button><button class="gbtn" id="viewIn">بيانات أقل <small>+</small></button><button class="gbtn" id="wDec">عرض شموع <small>−</small></button><button class="gbtn" id="wInc">عرض شموع <small>+</small></button><button class="gbtn" id="spaceDec">تباعد <small>−</small></button><button class="gbtn" id="spaceInc">تباعد <small>+</small></button><button class="gbtn" id="yDec">طول/زوم سعري <small>−</small></button><button class="gbtn" id="yInc">طول/زوم سعري <small>+</small></button><button class="gbtn" id="deepZoomOut">تكبير عام <small>−</small></button><button class="gbtn" id="deepZoomIn">تكبير عام <small>+</small></button><button class="gbtn" id="gridDec">حجم Grid <small>−</small></button><button class="gbtn" id="gridInc">حجم Grid <small>+</small></button><button class="gbtn" id="chartHDec">مساحة الشارت <small>−</small></button><button class="gbtn" id="chartHInc">مساحة الشارت <small>+</small></button></div></div><div class="time-bar"><span class="time-item">20:36</span><span class="time-item">21:08</span><span class="time-item">21:40</span><span class="time-item">22:12</span><span class="time-item">22:44</span><span class="time-item">23:16</span><span class="time-item">23:48</span></div><div class="trading-controls"><div class="control-row"><div class="input-group"><label class="input-label">المبلغ</label><div class="input-wrapper"><button class="ctrl-btn" onclick="changeAmount(-1)">-</button><input class="input-field" value="$ 1" id="amountInput"><button class="ctrl-btn" onclick="changeAmount(1)">+</button></div></div><div class="input-group"><label class="input-label">الوقت</label><div class="input-wrapper"><svg class="time-icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14" stroke="#888" fill="none" stroke-width="2"></polyline></svg><input class="input-field" value="22:19:00" id="timeInput"></div></div></div><div class="trading-buttons"><button class="trade-btn trade-higher"><svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M7 14l5-5 5 5z"></path></svg><span class="btn-text">شراء</span></button><button class="trade-btn trade-lower"><svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M7 10l5 5 5-5z"></path></svg><span class="btn-text">بيع</span></button></div></div><div class="bottom-nav"><div class="nav-item active"><img class="nav-icon" src="https://cdn-icons-png.flaticon.com/128/3446/3446795.png"><span class="nav-label">الشارت</span></div><div class="nav-item"><img class="nav-icon" src="https://cdn-icons-png.flaticon.com/128/10642/10642045.png"><span class="nav-label">سجل</span></div><div class="nav-item"><img class="nav-icon" src="https://cdn-icons-png.flaticon.com/128/10741/10741379.png"><span class="nav-label">ترتيب</span></div><div class="nav-item"><img class="nav-icon" src="https://cdn-icons-png.flaticon.com/128/1827/1827392.png"><span class="nav-label">اشعارات</span></div><div class="nav-item"><img class="nav-icon" src="https://cdn-icons-png.flaticon.com/128/839/839599.png"><span class="nav-label">اعدادات</span></div></div><script>let amt=1,chartH=300;function changeAmount(d){amt=Math.max(1,amt+d);amountInput.value="$ "+amt}function updateDateTime(){const n=new Date,y=n.getFullYear(),m=String(n.getMonth()+1).padStart(2,"0"),d=String(n.getDate()).padStart(2,"0"),h=String(n.getHours()).padStart(2,"0"),mi=String(n.getMinutes()).padStart(2,"0"),s=String(n.getSeconds()).padStart(2,"0");datetime.textContent=`${y}/${m}/${d} ⏰ ${h}:${mi}:${s} (UTC+03:00)`}setInterval(updateDateTime,1e3);updateDateTime();document.querySelectorAll(".trade-btn").forEach(b=>b.addEventListener("click",function(){this.style.transform="scale(.95)";setTimeout(()=>this.style.transform="scale(1)",150)}));document.querySelectorAll(".nav-item").forEach(it=>it.addEventListener("click",function(){document.querySelectorAll(".nav-item").forEach(i=>i.classList.remove("active"));this.classList.add("active")}));let chartAPI;(()=>{const LS="chart_sim_v4";const st=JSON.parse(localStorage.getItem(LS)||"{}");let Z=+(st.z||1),SP=+(st.sp||12),W=+(st.w||10),PAN=+(st.pan||0),CZ=+(st.cz||1),PZ=+(st.pz||1),GS=+(st.gs||52),PIN=+(st.pin||0),GZ=+(st.gz||1);const cv=document.getElementById("c"),ctx=cv.getContext("2d"),ps=document.getElementById("ps"),cpl=document.getElementById("cpl"),cpt=document.getElementById("cpt");let dpr=1,ww=0,hh=0,drag=0,sx=0,span0=0,tx=0,cp=1.1915,cs=[],vx=0,pressing=0;const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));const save=()=>localStorage.setItem(LS,JSON.stringify({z:Z,sp:SP,w:W,pan:PAN,cz:CZ,pz:PZ,gs:GS,pin:PIN,gz:GZ,psw:parseInt(getComputedStyle(document.documentElement).getPropertyValue("--psw"))||44,psm:document.documentElement.dataset.psmode||"1",ch:chartH}));const setup=()=>{const r=cv.parentElement.getBoundingClientRect();dpr=devicePixelRatio||1;const psw=parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--psw"))||44;ww=r.width-psw;hh=r.height;cv.width=Math.floor(r.width*dpr);cv.height=Math.floor(hh*dpr);cv.style.width=r.width+"px";cv.style.height=hh+"px";ctx.setTransform(dpr,0,0,dpr,0,0)};const rnd=s=>{const x=Math.sin(s)*1e4;return x-Math.floor(x)};const gen=(t,base)=>{const s=33333+Math.floor(t/6e4),r1=rnd(s),r2=rnd(s+1),r3=rnd(s+2),o=base,v=.0008*(.8+r1*1.4),tr=.00005*(r2-.5)*2,dir=r3>.5?1:-1,c=o+(dir*v+tr),h=Math.max(o,c)+Math.random()*.00035,l=Math.min(o,c)-Math.random()*.00035;return{t,o:+o.toFixed(5),c:+c.toFixed(5),h:+h.toFixed(5),l:+l.toFixed(5)}};const seed=()=>{cs=[];let t=Date.now()-520*6e4,p=cp;for(let i=0;i<520;i++){const k=gen(t,p);cs.push(k);p=k.c;t+=6e4}cp=cs[cs.length-1].c};seed();const prange=()=>{let mn=1e9,mx=-1e9;for(const k of cs){mn=Math.min(mn,k.l);mx=Math.max(mx,k.h)}const span=(mx-mn)||1e-6,mid=(mx+mn)/2,span2=span/Math.max(.35,PZ),mn2=mid-span2/2,mx2=mid+span2/2,pad=(mx2-mn2)*.10||1e-6;return{mn:mn2-pad,mx:mx2+pad}};const p2y=(p,r)=>{const n=(p-r.mn)/(r.mx-r.mn);return(hh-16)*(1-n)+8};const niceStep=r=>{const p=[1,2,5,10],x=Math.pow(10,Math.floor(Math.log10(r||1))),f=r/x;return(p.find(v=>f<=v)||10)*x};const drawScale=r=>{ps.innerHTML="";const span=r.mx-r.mn,step=niceStep(span/10),start=Math.floor(r.mn/step)*step;for(let p=start;p<=r.mx+step;p+=step){const y=p2y(p,r);if(y<0||y>hh)continue;const lb=document.createElement("div");lb.className="pl";lb.style.top=y+"px";lb.textContent=(+p).toFixed(5);ps.appendChild(lb)}};const spacing=()=>clamp(SP*Z*CZ*GZ,4.2,140);const xBase=()=>8+(PIN?0:PAN);const drawGrid=()=>{ctx.strokeStyle="rgba(255,255,255,.07)";ctx.lineWidth=1;const gs=clamp(GS/(Z*CZ),10,160);const offX=(((PIN?0:PAN))%gs+gs)%gs;for(let x=offX;x<(ww+(parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--psw"))||44));x+=gs){ctx.beginPath();ctx.moveTo(x+.5,0);ctx.lineTo(x+.5,hh);ctx.stroke()}for(let y=8;y<hh;y+=gs){ctx.beginPath();ctx.moveTo(0,y+.5);ctx.lineTo(ww+260,y+.5);ctx.stroke()}ctx.fillStyle="rgba(255,255,255,.02)";for(let x=offX;x<(ww+260);x+=gs/4)for(let y=8;y<hh;y+=gs/4)ctx.fillRect(x-1,y-1,2,2)};const drawC=(k,x,r,live)=>{const bull=k.c>=k.o,col=bull?"#10b981":"#ef4444",o=p2y(k.o,r),c=p2y(k.c,r),hi=p2y(k.h,r),lo=p2y(k.l,r);ctx.strokeStyle=col;ctx.lineWidth=1.35;ctx.beginPath();ctx.moveTo(x,hi);ctx.lineTo(x,lo);ctx.stroke();const top=Math.min(o,c),bh=Math.max(2,Math.abs(c-o));ctx.fillStyle=col;if(live){ctx.shadowColor=col;ctx.shadowBlur=7}ctx.fillRect(x-W/2,top,W,bh);ctx.shadowBlur=0};const updateLive=()=>{const last=cs[cs.length-1];let base=last.c;const t=Math.floor(Date.now()/6e4)*6e4;if(last.t<t){const nk=gen(t,base);cs.push(nk);cs.length>700&&cs.shift();cp=nk.c}else{const seed=Date.now();const r=(rnd(seed)-.5)*.00012;last.c=+(last.c+r).toFixed(5);last.h=+Math.max(last.h,last.c+Math.random()*.00005).toFixed(5);last.l=+Math.min(last.l,last.c-Math.random()*.00005).toFixed(5);cp=last.c}};const draw=()=>{if(!pressing&&Math.abs(vx)>.1&&!PIN){PAN+=vx;vx*=.88;save()}ctx.clearRect(0,0,cv.width/dpr,cv.height/dpr);const r=prange();drawGrid();const sp=spacing();let x0=xBase();for(let i=0;i<cs.length;i++){const x=x0+i*sp;if(x<-160||x>(ww+360))continue;drawC(cs[i],x,r,i===cs.length-1)}drawScale(r);const y=p2y(cp,r);cpl.style.top=y+"px";cpt.style.top=y+"px";cpt.textContent=cp.toFixed(5);requestAnimationFrame(draw)};const anchorZoom=(mx,f)=>{const sp0=spacing(),x0=xBase();const idx=(mx-x0)/sp0;GZ=clamp(GZ*f,.45,4.5);const sp1=spacing();const nx=x0+idx*sp1;mx=clamp(mx,0,ww);if(!PIN){PAN+=mx-nx}else{PAN=0}save()};const wheel=e=>{e.preventDefault();const rect=cv.getBoundingClientRect(),mx=e.clientX-rect.left;const f=e.deltaY<0?1.12:1/1.12;anchorZoom(mx,f)};const down=e=>{pressing=1;drag=1;sx=(e.clientX||e.touches[0].clientX);span0=PAN;vx=0;tx=Date.now()};const move=e=>{if(!drag||PIN)return;e.preventDefault();const cx=(e.clientX||e.touches[0].clientX),dx=cx-sx;PAN=span0+dx;const dt=Date.now()-tx;if(dt>0)vx=dx/(dt||1)*55;sx=cx;tx=Date.now();span0=PAN;save()};const up=()=>{drag=0;setTimeout(()=>pressing=0,50)};cv.addEventListener("wheel",wheel,{passive:!1});cv.addEventListener("mousedown",down);cv.addEventListener("touchstart",down,{passive:!1});addEventListener("mousemove",move);addEventListener("touchmove",move,{passive:!1});addEventListener("mouseup",up);addEventListener("touchend",up);document.getElementById("dots").onclick=()=>{CZ=clamp(CZ+0.12,.55,3.2);save()};chartAPI={setW:v=>{W=clamp(v,2,28);save()},setS:v=>{SP=clamp(v,6,70);save()},setP:v=>{PAN=v;save()},setCZ:v=>{CZ=clamp(v,.55,3.2);save()},setPZ:v=>{PZ=clamp(v,.35,2.6);save()},setGS:v=>{GS=clamp(v,14,180);save()},setPIN:v=>{PIN=v?1:0;if(PIN)PAN=0;save()},setGZ:v=>{GZ=clamp(v,.45,4.5);save()},zoomAt:(mx,f)=>anchorZoom(mx,f),getVals:()=>({W,SP,PAN,CZ,PZ,GS,PIN,GZ})};setInterval(updateLive,900);addEventListener("resize",setup);setup();draw()})();const $=i=>document.getElementById(i);const UIK="ctrl_ui_v2";const uiLoad=()=>{try{return JSON.parse(localStorage.getItem(UIK)||"{}")}catch{return{}}};const uiSave=o=>localStorage.setItem(UIK,JSON.stringify(o));const psClamp=v=>Math.max(18,Math.min(120,Number(v)||44));const setPS=(w,mode)=>{w=psClamp(w);document.documentElement.style.setProperty("--psw",w+"px");localStorage.setItem("psw",String(w));$("pswVal").textContent=String(w);$("pswInp").value=String(w);if(mode==null)mode=+(localStorage.getItem("psm")||"1");mode=mode?1:0;document.documentElement.dataset.psmode=String(mode);localStorage.setItem("psm",String(mode));$("psToggle").textContent=mode?"Overlay":"Bar";setTimeout(()=>chartAPI&&chartAPI.zoomAt&&chartAPI.zoomAt((document.getElementById("c").getBoundingClientRect().width/2),1),0)};const updZoomTxt=()=>{const v=chartAPI.getVals();$("maxZoomTxt").textContent=(v.GZ||1).toFixed(2)+"x"};const setChartH=d=>{chartH=Math.max(240,Math.min(540,chartH+d*24));$("chartContainer").style.height=`calc(100vh - ${chartH}px)`;localStorage.setItem("ch",String(chartH))};(()=>{const st=uiLoad();if(localStorage.getItem("ch"))chartH=parseInt(localStorage.getItem("ch"),10)||chartH;setChartH(0);setPS(localStorage.getItem("psw")||44,localStorage.getItem("psm")||"1");if(st&&st.ctrlHidden){$("ctrlPanel").style.display="none";$("toggleCtrl").textContent="إظهار";$("toggleCtrlMini").textContent="عرض التحكم"}})();$("pswPlus").onclick=()=>setPS((+localStorage.getItem("psw")||44)+2);$("pswMinus").onclick=()=>setPS((+localStorage.getItem("psw")||44)-2);$("pswInp").oninput=()=>{const v=String(pswInp.value||"").replace(/[^\d]/g,"");pswInp.value=v};$("pswInp").onblur=()=>setPS(pswInp.value);$("psToggle").onclick=()=>{const cur=+(localStorage.getItem("psm")||"1");setPS(localStorage.getItem("psw")||44,cur?0:1)};const updPinUI=()=>{const v=chartAPI.getVals();$("pinState").textContent=v.PIN?"ON":"OFF"};$("pinFirst").onclick=()=>{chartAPI.setPIN(1);updPinUI()};$("unpinFirst").onclick=()=>{chartAPI.setPIN(0);updPinUI()};updPinUI();const togglePanel=()=>{const p=$("ctrlPanel");const hid=p.style.display==="none";p.style.display=hid?"block":"none";$("toggleCtrl").textContent=hid?"إخفاء":"إظهار";$("toggleCtrlMini").textContent=hid?"إخفاء التحكم":"عرض التحكم";uiSave({ctrlHidden:!hid})};$("toggleCtrl").onclick=togglePanel;$("toggleCtrlMini").onclick=togglePanel;$("saveLocal").onclick=()=>{const v=chartAPI.getVals();uiSave({ctrlHidden:($("ctrlPanel").style.display==="none"),vals:v,psw:localStorage.getItem("psw"),psm:localStorage.getItem("psm"),ch:chartH});$("saveLocal").textContent="تم ✓";setTimeout(()=>$("saveLocal").textContent="حفظ عام",800)};$("resetAll").onclick=()=>{localStorage.removeItem("chart_sim_v4");localStorage.removeItem(UIK);location.reload()};const FA=1.12,PAN=160;panL.onclick=()=>{const v=chartAPI.getVals();chartAPI.setP(v.PIN?v.PAN:v.PAN+PAN)};panR.onclick=()=>{const v=chartAPI.getVals();chartAPI.setP(v.PIN?v.PAN:v.PAN-PAN)};viewIn.onclick=()=>{const rect=document.getElementById("c").getBoundingClientRect();chartAPI.zoomAt(rect.width/2,FA);updZoomTxt()};viewOut.onclick=()=>{const rect=document.getElementById("c").getBoundingClientRect();chartAPI.zoomAt(rect.width/2,1/FA);updZoomTxt()};deepZoomIn.onclick=()=>{const v=chartAPI.getVals();chartAPI.setCZ(v.CZ*FA)};deepZoomOut.onclick=()=>{const v=chartAPI.getVals();chartAPI.setCZ(v.CZ/FA)};wInc.onclick=()=>{const v=chartAPI.getVals();chartAPI.setW(v.W+2)};wDec.onclick=()=>{const v=chartAPI.getVals();chartAPI.setW(v.W-2)};spaceInc.onclick=()=>{const v=chartAPI.getVals();chartAPI.setS(v.SP+2)};spaceDec.onclick=()=>{const v=chartAPI.getVals();chartAPI.setS(v.SP-2)};yInc.onclick=()=>{const v=chartAPI.getVals();chartAPI.setPZ(v.PZ*FA)};yDec.onclick=()=>{const v=chartAPI.getVals();chartAPI.setPZ(v.PZ/FA)};gridInc.onclick=()=>{const v=chartAPI.getVals();chartAPI.setGS(v.GS*FA)};gridDec.onclick=()=>{const v=chartAPI.getVals();chartAPI.setGS(v.GS/FA)};chartHInc.onclick=()=>setChartH(1);chartHDec.onclick=()=>setChartH(-1);updZoomTxt();</script></body></html>
